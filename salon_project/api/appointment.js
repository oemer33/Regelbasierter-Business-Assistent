const { validateAppointment }=require("../src/validate"); const { saveAppointment }=require("../src/agent"); const { makeTransport,sendAppointmentMail }=require("../src/email");
module.exports=async(req,res)=>{ if(req.method!=="POST") return res.status(405).json({error:"Method not allowed"}); try{ const {name,service,datetime,contact,notes}=req.body||{}; const payload={name,service,datetime,contact,notes}; const val=validateAppointment(payload); if(!val.ok) return res.status(400).json({error:val.reason}); saveAppointment(payload); const transport=makeTransport(process.env); await sendAppointmentMail(transport,process.env,payload); res.json({ok:true,message:"Anfrage wurde gesendet"});}catch(e){res.status(500).json({error:"E-Mail Versand fehlgeschlagen",detail:e.message});}};